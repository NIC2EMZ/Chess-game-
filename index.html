<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        h1 {
            margin-bottom: 20px;
            color: #333;
        }
        .chessboard {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 2px solid #333;
        }
        .chessboard div {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
        }
        .chessboard .white {
            background-color: #f0d9b5;
        }
        .chessboard .black {
            background-color: #b58863;
        }
        .chessboard .valid-move {
            background-color: #8fd9a8 !important;
        }
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }
        .controls button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background-color: #6200ea;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .controls button:hover {
            background-color: #3700b3;
        }
        .turn-indicator {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Chess Game</h1>
    <div class="chessboard" id="chessboard"></div>
    <div class="controls">
        <button id="undoBtn">Cancel</button>
        <button id="resetBtn">Restart</button>
    </div>
    <div class="turn-indicator" id="turnIndicator">Tour : Blanc</div>

    <script>
        const chessboard = document.getElementById('chessboard');
        const turnIndicator = document.getElementById('turnIndicator');
        const undoBtn = document.getElementById('undoBtn');
        const resetBtn = document.getElementById('resetBtn');

        let board = [];
        let selectedPiece = null;
        let validMoves = [];
        let turn = 'white';
        let moveHistory = [];

        const initialBoard = [
            ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
            ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
            ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R']
        ];

        function initializeBoard() {
            board = JSON.parse(JSON.stringify(initialBoard));
            renderBoard();
        }

        function renderBoard() {
            chessboard.innerHTML = '';
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const cell = document.createElement('div');
                    cell.classList.add((row + col) % 2 === 0 ? 'white' : 'black');
                    cell.dataset.row = row;
                    cell.dataset.col = col;

                    const piece = board[row][col];
                    if (piece) {
                        cell.textContent = getPieceSymbol(piece);
                    }

                    cell.addEventListener('click', () => handleCellClick(row, col));
                    chessboard.appendChild(cell);
                }
            }
            highlightValidMoves();
        }

        function getPieceSymbol(piece) {
            const symbols = {
                'p': '♟', 'r': '♜', 'n': '♞', 'b': '♝', 'q': '♛', 'k': '♚',
                'P': '♙', 'R': '♖', 'N': '♘', 'B': '♗', 'Q': '♕', 'K': '♔'
            };
            return symbols[piece];
        }

        function handleCellClick(row, col) {
            const piece = board[row][col];

            if (selectedPiece) {
                if (validMoves.some(move => move[0] === row && move[1] === col)) {
                    movePiece(selectedPiece.row, selectedPiece.col, row, col);
                    selectedPiece = null;
                    validMoves = [];
                    toggleTurn();
                    renderBoard();
                } else {
                    selectedPiece = null;
                    validMoves = [];
                    renderBoard();
                }
            } else if (piece && (piece === piece.toUpperCase() ? turn === 'white' : turn === 'black')) {
                selectedPiece = { row, col, piece };
                validMoves = getValidMoves(row, col, piece);
                renderBoard();
            }
        }

        function movePiece(fromRow, fromCol, toRow, toCol) {
            const piece = board[fromRow][fromCol];
            board[toRow][toCol] = piece;
            board[fromRow][fromCol] = '';
            moveHistory.push({ fromRow, fromCol, toRow, toCol, piece });
        }

        function undoMove() {
            if (moveHistory.length > 0) {
                const lastMove = moveHistory.pop();
                board[lastMove.fromRow][lastMove.fromCol] = lastMove.piece;
                board[lastMove.toRow][lastMove.toCol] = '';
                toggleTurn();
                renderBoard();
            }
        }

        function resetGame() {
            initializeBoard();
            turn = 'white';
            moveHistory = [];
            turnIndicator.textContent = 'Tour : Blanc';
        }

        function toggleTurn() {
            turn = turn === 'white' ? 'black' : 'white';
            turnIndicator.textContent = `Tour : ${turn === 'white' ? 'Blanc' : 'Noir'}`;
        }

        function getValidMoves(row, col, piece) {
            const moves = [];
            const isWhite = piece === piece.toUpperCase();

            if (piece.toLowerCase() === 'p') {
                const direction = isWhite ? -1 : 1;
                if (isInsideBoard(row + direction, col) && board[row + direction][col] === '') {
                    moves.push([row + direction, col]);
                    if ((isWhite && row === 6) || (!isWhite && row === 1)) {
                        if (board[row + 2 * direction][col] === '') {
                            moves.push([row + 2 * direction, col]);
                        }
                    }
                }
                if (isInsideBoard(row + direction, col - 1) && board[row + direction][col - 1] !== '' &&
                    isOpponentPiece(row + direction, col - 1, isWhite)) {
                    moves.push([row + direction, col - 1]);
                }
                if (isInsideBoard(row + direction, col + 1) && board[row + direction][col + 1] !== '' &&
                    isOpponentPiece(row + direction, col + 1, isWhite)) {
                    moves.push([row + direction, col + 1]);
                }
            }

            return moves;
        }

        function isInsideBoard(row, col) {
            return row >= 0 && row < 8 && col >= 0 && col < 8;
        }

        function isOpponentPiece(row, col, isWhite) {
            const piece = board[row][col];
            return piece && (piece === piece.toUpperCase() ? !isWhite : isWhite);
        }

        function highlightValidMoves() {
            validMoves.forEach(move => {
                const cell = document.querySelector(`[data-row="${move[0]}"][data-col="${move[1]}"]`);
                if (cell) cell.classList.add('valid-move');
            });
        }

        undoBtn.addEventListener('click', undoMove);
        resetBtn.addEventListener('click', resetGame);

        initializeBoard();
    </script>
</body>
</html>
